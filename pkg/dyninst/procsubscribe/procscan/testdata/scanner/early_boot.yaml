# Test edge case: now < startDelay (machine just booted).
# Scanner should handle this by setting nextWatermark = now instead of (now - startDelay).
# This prevents negative watermarks and ensures we scan all processes from boot.
- !initialize
  current_time: 50
  start_delay: 100
- !create-process
  pid: 1001
  start_time: 10
  tracer_metadata: {language: "go", service: "early-service"}
- !create-process
  pid: 1002
  start_time: 49
  tracer_metadata: {language: "go", service: "early-service"}
- !scan {}
- !advance-time {to: 51}
- !create-process
  pid: 1003
  start_time: 51
  tracer_metadata: {language: "go", service: "a-bit-later"}
- !scan {}
- !advance-time {to: 102}
- !create-process
  pid: 1004
  start_time: 101
  tracer_metadata: {language: "go", service: "a-bit-after-that"}
- !scan {}
- !advance-time {to: 202}
- !create-process
  pid: 1005
  start_time: 201
  tracer_metadata: {language: "go", service: "even-later"}
- !scan {}
---
command: !initialize
  current_time: 50
  start_delay: 100
---
command: !create-process
  pid: 1001
  start_time: 10
  tracer_metadata: {language: "go", service: "early-service"}
---
command: !create-process
  pid: 1002
  start_time: 49
  tracer_metadata: {language: "go", service: "early-service"}
---
command: !scan {}
new: [1001, 1002]
state:
  current_time: 50
  last_watermark: 50
  start_delay: 100
  live: [1001, 1002]
  processes_in_procfs: [1001, 1002]
---
command: !advance-time {to: 51}
---
command: !create-process
  pid: 1003
  start_time: 51
  tracer_metadata: {language: "go", service: "a-bit-later"}
---
command: !scan {}
new: [1003]
state:
  current_time: 51
  last_watermark: 51
  live: [1001, 1002, 1003]
  processes_in_procfs: [1001, 1002, 1003]
---
command: !advance-time {to: 102}
---
command: !create-process
  pid: 1004
  start_time: 101
  tracer_metadata: {language: "go", service: "a-bit-after-that"}
---
command: !scan {}
new: [1004]
state:
  current_time: 102
  last_watermark: 102
  live: [1001, 1002, 1003, 1004]
  processes_in_procfs: [1001, 1002, 1003, 1004]
---
command: !advance-time {to: 202}
---
command: !create-process
  pid: 1005
  start_time: 201
  tracer_metadata: {language: "go", service: "even-later"}
---
command: !scan {}
state:
  current_time: 202
  last_watermark: 102
  live: [1001, 1002, 1003, 1004]
  processes_in_procfs: [1001, 1002, 1003, 1004, 1005]
